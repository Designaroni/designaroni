{% comment %}Loop Through All Categories{% endcomment %}
<section class="post-categories-filter">
  <h2>Filter Categories</h2>
    {% for category in site.categories %}
      {% assign categoryname = [category | first] %}
      <a class="post-categories-tag {{ categoryname }}"><span class="hide-all"></span>{{ categoryname }}<span class="show-all"></span></a>
    {% endfor %}
</section>
{% include _modules/loopPostsDisplayCategories.html %}
<script>
var categories = [];
var visibleCategories = [];
var notVisibleCategories = [];
var minus = '- ';
var plus = '+ ';
var hasnone = '- 0';
{% for category in site.categories %}
  {% assign categoryname = [category | first] %}
  if ( $('.post-categories-filter-group .{{categoryname}}').length > 0 ) {
    $('.post-categories-tag.{{ categoryname }}').addClass('selected');
  }
  categories.push('{{ categoryname }}');
{% endfor %}
whatsVisible();
// $(document).on('click','.post-categories-tag', function() {
//   for (var i = 0; i < categories.length; i++) {
//     if ($(this).hasClass(categories[i]) && $(this).hasClass('selected')) {
//       $(this).removeClass('selected')
//       $('.post-categories-filter-group').find('.'+categories[i]).hide();
//     } else if ($(this).hasClass(categories[i]) && !$(this).hasClass('selected')) {
//       $(this).addClass('selected')
//       $('.post-categories-filter-group').find('.'+categories[i]).show();
//     }
//   }
//   whatsVisible();
// });

// show-all clicked
$(document).on('click','.post-categories-tag .show-all', function(e) {
  console.log('show-all')
  for (var i = 0; i < categories.length; i++) {
    if ($(this).parent().hasClass(categories[i]) && (!$(this).parent().hasClass('selected') || $(this).parent().hasClass('hasMore'))) {
      $(this).parent().addClass('selected')
      $('.post-categories-filter-group').find('.'+categories[i]).show();
    }
  }
  whatsVisible();
  e.stopPropagation();
});
// hide-all clicked
$(document).on('click','.post-categories-tag .hide-all', function(e) {
  console.log('hide-all')
  for (var i = 0; i < categories.length; i++) {
    if ($(this).parent().hasClass(categories[i]) && $(this).parent().hasClass('selected')) {
      $(this).parent().removeClass('selected')
      $('.post-categories-filter-group').find('.'+categories[i]).hide();
    }
  }
  whatsVisible();
  e.stopPropagation();
});

function whatsVisible() {
  visibleCategories = [];
  notVisibleCategories = [];
  $('.post-categories-tag span').text(hasnone).parent().removeClass('selected hasMore hasLess');
  $('.post-categories-filter-group .post-category:visible').each( function() {
    visibleCategories.push($(this).text());
  })
  $('.post-categories-filter-group .post-category:not(:visible)').each( function() {
    notVisibleCategories.push($(this).text());
  })
  visibleCategories.forEach( function(k) {
    var count = 0;
    for(var i = 0; i < visibleCategories.length; ++i){
      if(visibleCategories[i] == k) {
        count++;
        $('.post-categories-tag.'+k+' span.hide-all').text(minus+count).parent().addClass('selected hasLess');
      }
    }
  })
  notVisibleCategories.forEach( function(k) {
    var count = 0;
    for(var i = 0; i < notVisibleCategories.length; ++i){
      if(notVisibleCategories[i] == k) {
        count++;
        $('.post-categories-tag.'+k+' span.show-all').text(plus+count).parent().addClass('hasMore');
      }
    }
  })
}
</script>
